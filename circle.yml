machine:
  services:
    - redis
    - docker
  python:
    version: 2.7.6

dependencies:
  pre:
    - pip install awscli
  override:
    - npm install
  post:
    - bower install
    - npm install testem -g
    - npm install -g ember-cli

test:
  override:
    - echo 1
  post:
    - docker build build -t sagebrew/sb_app:$CIRCLE_SHA .
    - docker run --name $APP_NAME --env APP_NAME=ember-app --env REDIS_SERVER=localhost sb_app:latest

deployment:
  production:
    branch: master
    commands:
      - ember deploy --environment production
  staging:
    branch: staging
    commands:
      - ember deploy --environment staging
      - bash -x ~/com.sagebrew.frontend/deployment/staging.sh $CIRCLE_SHA1