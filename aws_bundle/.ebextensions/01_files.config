files:
    "/etc/nginx/conf.d/000_my_conf.conf" :
        mode: "000755"
        owner: root
        group: root
        content: |
           server {
              listen       80;
              server_name  localhost;
              location / {
                    if ($http_x_forwarded_proto != "https") {
                        rewrite ^(.*)$ https://$server_name$1 permanent;
                    }
                    # checks for static file, if not found proxy to app
                    try_files $uri @proxy_to_app;
              }

              location @proxy_to_app {
                  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                  proxy_set_header Host $http_host;
                  proxy_redirect off;
                  proxy_set_header X-Real-IP $remote_addr;
                  proxy_set_header X-Scheme $scheme;
                  proxy_read_timeout 1200;
                  proxy_pass http://docker;
                  proxy_http_version 1.1;
                  proxy_set_header Upgrade $http_upgrade;
                  proxy_set_header Connection 'upgrade';
                  proxy_cache_bypass $http_upgrade;
              }
            }